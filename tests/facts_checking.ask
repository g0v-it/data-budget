##################################
# Test fr-ap Facts constraints
################################## 
PREFIX fr: <http://linkeddata.center/botk-fr/v1#>
PREFIX qb: <http://purl.org/linked-data/cube#>
PREFIX time: <http://www.w3.org/2006/time#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX sdmx-attribute:	<http://purl.org/linked-data/sdmx/2009/attribute#> 
PREFIX mef: <http://w3id.org/g0v/it/mef#>

ASK {
    ?obs a mef:Fact.

    # Every mef:Fact has exactly one associated financial report.
    {
        ?obs qb:dataSet ?dataset1.
        ?dataset1 a mef:Budget.
        FILTER NOT EXISTS { ?obs qb:dataSet ?dataset2 FILTER (?dataset1 != ?dataset2) }
    }
    
 
    # Every fr:Fact does not have  an unitMeasure attribute or it is the same of the dataset one.    
    {
        {
            FILTER NOT EXISTS { ?obs sdmx-attribute:unitMeasure ?unit1 . }
        } UNION {
            ?obs sdmx-attribute:unitMeasure ?unit1.
            ?dataset1 sdmx-attribute:unitMeasure ?unit1.
        }
    }
}
    